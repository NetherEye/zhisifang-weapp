(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"0253":function(t,e,a){"use strict";var i=a("d64e"),s=a.n(i);s.a},"1cb1":function(t,e,a){"use strict";a.r(e);var i=a("6fb1"),s=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=s.a},"444c":function(t,e,a){"use strict";a("ce60");var i=o(a("b0ce")),s=o(a("cf93"));function o(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(s.default))},"6fb1":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(a("a34a")),s=r(a("784f")),o=r(a("65d7")),n=a("2f62");function r(t){return t&&t.__esModule?t:{default:t}}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},i=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),i.forEach(function(e){l(t,e,a[e])})}return t}function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function u(t,e,a,i,s,o,n){try{var r=t[o](n),c=r.value}catch(l){return void a(l)}r.done?e(c):Promise.resolve(c).then(i,s)}function g(t){return function(){var e=this,a=arguments;return new Promise(function(i,s){var o=t.apply(e,a);function n(t){u(o,i,s,n,r,"next",t)}function r(t){u(o,i,s,n,r,"throw",t)}n(void 0)})}}var h=a("bec1"),p={data:function(){return{banner:[],locationAuth:!1,tbsActiveDataType:"人气景区",hotPage:{scHotList:[],pageNumber:1,pageSize:10,rqStatus:"上拉加载更多"},morePage:{moreSpotList:[],nearbyActive:"",pageNumber:1,pageSize:10,rqStatus:"上拉加载更多"},norPage:{nearbyActive:"",markers:[],scMarkObj:{show:!1,info:{}}},nearbyTags:[],center:{longitude:106.63,latitude:26.65},httpCount:0}},onPullDownRefresh:function(){this.banner=[],"人气景区"==this.tbsActiveDataType&&(this.hotPage={scHotList:[],pageNumber:1,pageSize:10,rqStatus:"上拉加载更多"},this.getBanner(),this.getScHotList()),"附近景区"==this.tbsActiveDataType&&(this.nearbyTags=[],this.norPage={nearbyActive:"",markers:[],scMarkObj:{show:!1,info:{}}},this.getScTypes(),this.getBanner(),this.getLocationAuth()),"更多景区"==this.tbsActiveDataType&&(this.nearbyTags=[],this.morePage={moreSpotList:[],nearbyActive:"",pageNumber:1,pageSize:10,rqStatus:"上拉加载更多"},this.getScTypes(),this.getBanner(),this.getMoreSpotList())},onReachBottom:function(){"人气景区"==this.tbsActiveDataType?(this.hotPage.pageNumber=this.hotPage.pageNumber+1,this.getScHotList()):"更多景区"==this.tbsActiveDataType&&(this.morePage.pageNumber=this.morePage.pageNumber+1,this.getMoreSpotList())},onLoad:function(){var e=g(i.default.mark(function e(){var a,s,o,n;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,h.isLogin();case 2:if(a=e.sent,a){e.next=8;break}return e.next=6,h.logining();case 6:s=e.sent,s||(o=getCurrentPages(),n=o[o.length-1].route.slice(o[o.length-1].route.lastIndexOf("/")+1),t.redirectTo({url:"../userInfoAuth/userInfoAuth?goBack="+n}));case 8:return e.t0=this.$store,e.next=11,h.getMoneyHide();case 11:e.t1=e.sent,e.t0.commit.call(e.t0,"setMoneyHide",e.t1),this.getBanner(),this.getScHotList(),this.getScTypes();case 16:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),onHide:function(){},onShow:function(){},methods:{setNearbyActive:function(t){this.norPage.markers=[],this.norPage.nearbyActive==t.id?this.norPage.nearbyActive="":this.norPage.nearbyActive=t.id,this.getScMarks()},setNearbyActive2:function(t){this.morePage.nearbyActive==t.id?this.morePage.nearbyActive="":(this.morePage.pageNumber=1,this.morePage.pageSize=10,this.morePage.nearbyActive=t.id),this.morePage.moreSpotList=[],this.morePage.rqStatus="上拉加载更多",this.getMoreSpotList()},getBanner:function(){var e=this;this.httpCount++,o.default.rq({url:s.default.banner}).then(function(a){e.httpCount--,e.httpCount<0?e.httpCount=0:0==e.httpCount&&t.stopPullDownRefresh(),200===a.code?e.banner=a.data:e.banner=[]})},getScTypes:function(){var e=this;this.httpCount++,o.default.rq({url:s.default.getScType}).then(function(a){e.httpCount--,e.httpCount<0?e.httpCount=0:0==e.httpCount&&t.stopPullDownRefresh(),200===a.code?e.nearbyTags=a.data:e.nearbyTags=[]})},getMoreSpotList:function(){var e=this;this.httpCount++,this.morePage.rqStatus="加载中...",o.default.rq({url:s.default.moreSpotList,data:{pageNumber:this.morePage.pageNumber,pageSize:this.morePage.pageSize,scenicTypeId:this.morePage.nearbyActive}}).then(function(a){e.httpCount--,e.httpCount<0?e.httpCount=0:0==e.httpCount&&t.stopPullDownRefresh(),200===a.code?(a.data.forEach(function(t){t["scenicTags"]=t.tag?t.tag.split(","):[],t["popularityTotal"]=h.handleNumber(t["popularityTotal"]),t["listenTotal"]=h.handleNumber(t["listenTotal"])}),e.morePage.moreSpotList=e.morePage.moreSpotList.concat(a.data),e.morePage.moreSpotList.length>=a.total?e.morePage.rqStatus="没有更多了":e.morePage.rqStatus="上拉加载更多"):(e.morePage.pageNumber>1&&(e.morePage.pageNumber=e.morePage.pageNumber-1),e.morePage.rqStatus="没有更多了")})},getScHotList:function(){var e=this;this.httpCount++,this.hotPage.rqStatus="加载中...",o.default.rq({url:s.default.scHotList,data:{pageNumber:this.hotPage.pageNumber,pageSize:this.hotPage.pageSize}}).then(function(a){e.httpCount--,e.httpCount<0?e.httpCount=0:0==e.httpCount&&t.stopPullDownRefresh(),200===a.code?(a.data.forEach(function(t){t["scenicTags"]=t.tag?t.tag.split(","):[],t["popularityTotal"]=h.handleNumber(t["popularityTotal"])}),e.hotPage.scHotList=e.hotPage.scHotList.concat(a.data),e.hotPage.scHotList.length>=a.total?e.hotPage.rqStatus="没有更多了":e.hotPage.rqStatus="上拉加载更多"):(e.hotPage.pageNumber>1&&(e.hotPage.pageNumber=e.hotPage.pageNumber-1),e.hotPage.rqStatus="没有更多了")})},goSearch:function(){t.navigateTo({url:"../search/search"})},goToMe:function(){t.navigateTo({url:"../my/my"})},handleTabsChange:function(t){var e=t.detail;this.tbsActiveDataType=e.title,"附近景区"==e.title&&(this.norPage={nearbyActive:"",markers:[],scMarkObj:{show:!1,info:{}}},this.getLocationAuth()),"更多景区"==e.title&&0==this.morePage.moreSpotList.length&&this.getMoreSpotList()},getLocationAuth:function(){var e=this;t.authorize({scope:"scope.userLocation",success:function(){e.locationAuth=!0,e.getlocation()},fail:function(){e.locationAuth=!1}})},getlocation:function(){var e=this;t.getLocation({success:function(a){e.center["longitude"]=a.longitude,e.center["latitude"]=a.latitude,e.getScMarks();var i=t.createSelectorQuery();i.select(".content").boundingClientRect(),i.selectViewport().scrollOffset(),i.exec(function(e){t.pageScrollTo({scrollTop:e[0].bottom,duration:300})})},fail:function(){}})},getScMarks:function(){var e=this,a=t.createMapContext("map",this);this.httpCount++,o.default.rq({url:s.default.getNearbySc,data:{pageNumber:1,pageSize:1e3,lat:this.center["latitude"],lon:this.center["longitude"],scenicTypeId:this.norPage.nearbyActive}}).then(function(i){if(e.httpCount--,e.httpCount<0?e.httpCount=0:0==e.httpCount&&t.stopPullDownRefresh(),200===i.code){var s=[];i.data.forEach(function(t){e.norPage.markers.push({id:t.id,latitude:t.lat,longitude:t.lon,iconPath:"../../static/image/xuanzhong.png",width:30,height:40,scenicName:t.scenicName,photo:t.photo,distance:(t.distance/1e3).toFixed(1),address:t.address}),s.push({latitude:t.lat,longitude:t.lon})}),s.push(e.center),a.includePoints({points:s,padding:[40,40,40,40]})}else e.norPage.markers=[]})},handleScMark:function(t){var e=this,a=t.mp;this.norPage.markers.forEach(function(t){t.id==a.markerId&&(e.norPage.scMarkObj={show:!0,info:t})})},handleTabMap:function(){this.norPage.scMarkObj={show:!1,info:{}}},goMapDetail:function(){t.navigateTo({url:"../scMapDetail/scMapDetail?id="+this.norPage.scMarkObj.info["id"]})},getScDetail:function(e){t.navigateTo({url:"../scMapDetail/scMapDetail?id="+e.id})},goToWhat:function(){t.navigateTo({url:"../banner/banner"})},opensetting:function(t){var e=t.detail;e.authSetting["scope.userLocation"]?(this.locationAuth=!0,this.getlocation()):this.locationAuth=!1}},computed:c({},(0,n.mapState)(["MoneyHide"]))};e.default=p}).call(this,a("543d")["default"])},cf93:function(t,e,a){"use strict";a.r(e);var i=a("eb15"),s=a("1cb1");for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);a("0253");var n=a("2877"),r=Object(n["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},d64e:function(t,e,a){},eb15:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"pub_wrap"},[a("view",{staticClass:"content"},[a("view",{staticClass:"search",attrs:{eventid:"26cf05aa-0"},on:{click:t.goSearch}},[a("image",{attrs:{src:"../../static/image/search.png"}}),a("text",[t._v("去你想去的地方")])]),a("view",{staticClass:"banner"},[a("swiper",{staticClass:"swiper",attrs:{circular:"","indicator-dots":!0,"indicator-color":"#ffffff","indicator-active-color":"#02a9f0",autoplay:!0,interval:3e3,duration:500}},t._l(t.banner,function(e,i){return a("swiper-item",{key:i,staticClass:"swiper-item",attrs:{eventid:"26cf05aa-1-"+i,mpcomid:"26cf05aa-0-"+i},on:{click:t.goToWhat}},[a("image",{staticClass:"img bannerImg",attrs:{mode:"aspectFill",src:e.photo}})])}))],1),a("view",{staticClass:"line"}),a("view",{staticClass:"main"},[a("view",{staticClass:"tbs"},[a("van-tabs",{attrs:{"custom-class":"gen-tab",border:!1,"nav-class":"nav-tab","tab-class":"tab-tab",sticky:"",eventid:"26cf05aa-9",mpcomid:"26cf05aa-13"},on:{change:t.handleTabsChange}},[a("van-tab",{attrs:{title:"人气景区",mpcomid:"26cf05aa-2"}},[a("scroll-view",{staticClass:"tbs-box"},[t._l(t.hotPage.scHotList,function(e,i){return a("view",{key:i,staticClass:"sc-list-item",attrs:{eventid:"26cf05aa-2-"+i},on:{click:function(a){t.getScDetail(e)}}},[a("view",{staticClass:"sc-list-img"},[a("image",{attrs:{src:e.photo,mode:"aspectFill","lazy-load":""}}),a("view",{staticClass:"sc-list-name"},[a("text",[t._v(t._s(e.scenicName))])]),a("view",{staticClass:"info"},[e.voiceTotal?a("text",[t._v("讲解："+t._s(e.voiceTotal)+"个景点")]):t._e(),e.narratorPrice&&t.MoneyHide?a("text",[t._v(t._s(e.narratorPrice)+"元/份")]):t._e()])]),e.popularityTotal?a("view",{staticClass:"pop"},[a("image",{attrs:{src:"../../static/image/hot.png","lazy-load":""}}),a("view",{staticClass:"pop-text"},[a("text",[t._v("人气："+t._s(e.popularityTotal))])])]):t._e(),e.address?a("view",{staticClass:"sc-list-site"},[a("image",{attrs:{src:"../../static/image/posi.png"}}),a("text",[t._v(t._s(e.address))])]):t._e(),a("view",{staticClass:"sc-list-info"},[a("text",[t._v(t._s(e.summary))])]),a("view",{staticClass:"sc-list-tag"},t._l(e.scenicTags,function(e,i){return a("text",{key:i},[t._v(t._s(e))])}))])}),a("wux-divider",{attrs:{mpcomid:"26cf05aa-1"}},[t._v(t._s(t.hotPage.rqStatus))])],2)],1),a("van-tab",{attrs:{title:"附近景区",mpcomid:"26cf05aa-10"}},[0!=t.nearbyTags.length&&t.locationAuth?a("view",{staticClass:"scroll-tags-box"},[a("scroll-view",{staticClass:"scroll-tags",attrs:{"scroll-x":""}},t._l(t.nearbyTags,function(e,i){return a("view",{key:e.id,staticClass:"scroll-tag",class:e.id==t.norPage.nearbyActive?"scroll-tag-active":"",attrs:{eventid:"26cf05aa-3-"+i},on:{click:function(a){t.setNearbyActive(e)}}},[a("text",[t._v(t._s(e.typeName))])])}))],1):t._e(),t.locationAuth?t._e():[a("view",{staticClass:"locationAuth"},[a("image",{attrs:{src:"../../static/image/loca.png",mode:""}}),a("text",[t._v("您还未授权地理定位")]),a("text",[t._v("无法获取附近景区")]),a("view",{staticClass:"btn",staticStyle:{position:"relative"}},[t._v("去授权"),a("button",{staticStyle:{width:"100%",height:"100%",opacity:"0",position:"absolute",top:"0",left:"0"},attrs:{"open-type":"openSetting",eventid:"26cf05aa-4"},on:{opensetting:t.opensetting}},[t._v("打开授权设置页")])],1)])],t.locationAuth?[a("view",{staticClass:"showMap"},[a("view",{staticClass:"map"},[a("map",{directives:[{name:"show",rawName:"v-show",value:"附近景区"==t.tbsActiveDataType,expression:"tbsActiveDataType == '附近景区'"}],staticStyle:{width:"100%",height:"100%"},attrs:{id:"map","show-location":!0,latitude:t.center.latitude,markers:t.norPage.markers,longitude:t.center.longitude,eventid:"26cf05aa-6"},on:{tap:t.handleTabMap,markertap:t.handleScMark}},[t.norPage.scMarkObj.show?a("cover-view",{staticClass:"siteInfo",attrs:{eventid:"26cf05aa-5",mpcomid:"26cf05aa-8"},on:{click:t.goMapDetail}},[a("cover-image",{attrs:{src:t.norPage.scMarkObj.info["photo"],mpcomid:"26cf05aa-4"}}),a("cover-view",{staticClass:"siteTextInfo",attrs:{mpcomid:"26cf05aa-7"}},[a("cover-view",{staticClass:"siteInfo-name els",attrs:{mpcomid:"26cf05aa-5"}},[t._v(t._s(t.norPage.scMarkObj.info["scenicName"]))]),a("cover-view",{staticClass:"siteInfo-site",attrs:{mpcomid:"26cf05aa-6"}},[t._v("距您 "+t._s(t.norPage.scMarkObj.info["distance"])+" km | "+t._s(t.norPage.scMarkObj.info["address"]))])],1)],1):t._e()],1)],1)])]:t._e()],2),a("van-tab",{attrs:{title:"更多景区",mpcomid:"26cf05aa-12"}},[0!=t.nearbyTags.length?a("view",{staticClass:"scroll-tags-box"},[a("scroll-view",{staticClass:"scroll-tags",attrs:{"scroll-x":""}},t._l(t.nearbyTags,function(e,i){return a("view",{key:e.id,staticClass:"scroll-tag",class:e.id==t.morePage.nearbyActive?"scroll-tag-active":"",attrs:{eventid:"26cf05aa-7-"+i},on:{click:function(a){t.setNearbyActive2(e)}}},[a("text",[t._v(t._s(e.typeName))])])}))],1):t._e(),a("scroll-view",{staticClass:"tbs-box"},[t._l(t.morePage.moreSpotList,function(e,i){return a("view",{key:i,staticClass:"sc-list-item2",attrs:{eventid:"26cf05aa-8-"+i},on:{click:function(a){t.getScDetail(e)}}},[a("view",{staticClass:"sc-list-img"},[a("image",{staticClass:"bf",attrs:{src:"../../static/image/bf.png"}}),a("image",{attrs:{src:e.photo,mode:"aspectFill","lazy-load":""}}),a("view",{staticClass:"sc-list-name els"},[a("text",[t._v(t._s(e.scenicName))])]),a("view",{staticClass:"info"},[e.voiceTotal?a("text",[t._v("讲解："+t._s(e.voiceTotal)+"个景点")]):t._e(),a("text",[t._v("收听量："+t._s(e.listenTotal))]),e.narratorPrice&&t.MoneyHide?a("text",[t._v(t._s(e.narratorPrice)+"元/份")]):t._e()]),a("view",{staticClass:"sc-list-site"},[a("image",{attrs:{src:"../../static/image/posi.png"}}),a("text",{staticClass:"els"},[t._v(t._s(e.address))])]),a("view",{staticClass:"sc-list-info"},[a("text",[t._v(t._s(e.summary))]),a("view",{staticClass:"sc-list-info-opc"})]),a("view",{staticClass:"sc-list-tag"},t._l(e.scenicTags,function(e,i){return a("text",{key:i},[t._v(t._s(e))])}))])])}),a("wux-divider",{attrs:{mpcomid:"26cf05aa-11"}},[t._v(t._s(t.morePage.rqStatus))])],2)],1)],1)],1)]),a("view",{staticClass:"goToMe",attrs:{eventid:"26cf05aa-10"},on:{click:t.goToMe}},[a("image",{attrs:{src:"../../static/image/circle.png"}})])])])},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})}},[["444c","common/runtime","common/vendor"]]]);